

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>joint_trajectory_controller &mdash; ROS2_Control: Rolling Jul 2023 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/override.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon_ros-controls.ico"/>
  

  
  

  
    <link rel="canonical" href="https://control.ros.org/rolling//rolling/doc/ros2_controllers/joint_trajectory_controller/doc/userdoc.html" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../_static/clipboard.min.js"></script>
        <script src="../../../../_static/copybutton.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="position_controllers" href="../../position_controllers/doc/userdoc.html" />
    <link rel="prev" title="Gripper Action Controller" href="../../gripper_controllers/doc/userdoc.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html">
          

          
            
            <img src="../../../../_static/logo_ros-controls.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/getting_started.html#architecture">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/getting_started.html#hardware-components">Hardware Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control/doc/index.html">ros2_control</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../doc/controllers_index.html">ros2_controllers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#nomenclature">Nomenclature</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#guidelines-and-best-practices">Guidelines and Best Practices</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../doc/controllers_index.html#available-controllers">Available Controllers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../ackermann_steering_controller/doc/userdoc.html">Ackermann Steering Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admittance_controller/doc/userdoc.html">Admittance Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../bicycle_steering_controller/doc/userdoc.html">Bicycle Steering Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../diff_drive_controller/doc/userdoc.html">Differential Drive Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../effort_controllers/doc/userdoc.html">Effort Controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../forward_command_controller/doc/userdoc.html">Forward Command Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gripper_controllers/doc/userdoc.html">Gripper Controller</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Joint Trajectory Controller</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#trajectory-representation">Trajectory representation </a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware-interface-type">Hardware interface type </a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-features">Other features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-joint-trajectory-controller-s">Using Joint Trajectory Controller(s)</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#preemption-policy">Preemption policy </a></li>
<li class="toctree-l5"><a class="reference internal" href="#details-about-parameters">Details about parameters</a></li>
<li class="toctree-l5"><a class="reference internal" href="#description-of-controller-s-interfaces">Description of controller’s interfaces</a><ul>
<li class="toctree-l6"><a class="reference internal" href="#references">References</a></li>
<li class="toctree-l6"><a class="reference internal" href="#states">States</a></li>
<li class="toctree-l6"><a class="reference internal" href="#commands">Commands</a></li>
<li class="toctree-l6"><a class="reference internal" href="#actions">Actions  </a></li>
<li class="toctree-l6"><a class="reference internal" href="#subscriber">Subscriber </a></li>
<li class="toctree-l6"><a class="reference internal" href="#publishers">Publishers</a></li>
<li class="toctree-l6"><a class="reference internal" href="#services">Services</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#specialized-versions-of-jointtrajectorycontroller-tbd-in">Specialized versions of JointTrajectoryController (TBD in …)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../position_controllers/doc/userdoc.html">Position Controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../steering_controllers_library/doc/userdoc.html">Steering Controllers Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tricycle_controller/doc/userdoc.html">Tricycle Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../tricycle_steering_controller/doc/userdoc.html">Tricycle Steering Controller</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../velocity_controllers/doc/userdoc.html">Velocity Controllers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../doc/controllers_index.html#available-broadcasters">Available Broadcasters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control/ros2controlcli/doc/userdoc.html">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../differences_to_ros1/differences_to_ros1.html">Differences to ros_control (ROS1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../differences_to_ros1/differences_to_ros1.html#migration-guide-to-ros2-control">Migration Guide to ros2_control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ros2_control_demos/doc/index.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../supported_robots/supported_robots.html">Supported Robots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources/resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/contributing.html">Pull Requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/contributing.html#rules-for-the-repositories-and-process-of-merging-pull-requests">Rules for the repositories and process of merging pull requests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/contributing.html#writing-documentation">Writing documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/contributing.html#repository-structure-and-ci-configuration">Repository structure and CI configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../project_ideas.html">Project Ideas for GSoC 2022</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../acknowledgements/acknowledgements.html">Acknowledgements</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ROS2_Control: Rolling</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../doc/controllers_index.html">ros2_controllers</a> &raquo;</li>
        
      <li>joint_trajectory_controller</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <!-- User defined GitHub URL -->
              <a href="https://github.com/ros-controls/ros2_controllers/blob/master/joint_trajectory_controller/doc/userdoc.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="joint-trajectory-controller">
<span id="joint-trajectory-controller-userdoc"></span><h1>joint_trajectory_controller<a class="headerlink" href="#joint-trajectory-controller" title="Permalink to this heading"></a></h1>
<p>Controller for executing joint-space trajectories on a group of joints.
The controller interpolates in time between the points so that their distance can be arbitrary.
Even trajectories with only one point are accepted.
Trajectories are specified as a set of waypoints to be reached at specific time instants,
which the controller attempts to execute as well as the mechanism allows.
Waypoints consist of positions, and optionally velocities and accelerations.</p>
<p><em>Parts of this documentation were originally published in the ROS 1 wiki under the</em> <a class="reference external" href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0 license</a>. <em>Citations are given in the respective section, but were adapted for the ROS 2 implementation.</em> <a class="footnote-reference brackets" href="#f1" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> <a class="footnote-reference brackets" href="#f2" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<section id="trajectory-representation">
<h2>Trajectory representation <a class="footnote-reference brackets" href="#f1" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="headerlink" href="#trajectory-representation" title="Permalink to this heading"></a></h2>
<p>Trajectories are represented internally with <code class="docutils literal notranslate"><span class="pre">trajectory_msgs/msg/JointTrajectory</span></code> data structure.
By default, a spline interpolator is provided, but it’s possible to support other representations.
The spline interpolator uses the following interpolation strategies depending on the waypoint specification:</p>
<ul class="simple">
<li><p>Linear: Only position is specified. Guarantees continuity at the position level. Discouraged because it yields trajectories with discontinuous velocities at the waypoints.</p></li>
<li><p>Cubic: Position and velocity are specified. Guarantees continuity at the velocity level.</p></li>
<li><p>Quintic: Position, velocity and acceleration are specified: Guarantees continuity at the acceleration level.</p></li>
</ul>
</section>
<section id="hardware-interface-type">
<h2>Hardware interface type <a class="footnote-reference brackets" href="#f1" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="headerlink" href="#hardware-interface-type" title="Permalink to this heading"></a></h2>
<p>Currently joints with position, velocity, acceleration, and effort interfaces are supported. The joints can have one or more command interfaces, where the following control laws are applied at the same time:</p>
<ul class="simple">
<li><p>For command interfaces <code class="docutils literal notranslate"><span class="pre">position</span></code>, the desired positions are simply forwarded to the joints,</p></li>
<li><p>For command interfaces <code class="docutils literal notranslate"><span class="pre">acceleration</span></code>, desired accelerations are simply forwarded to the joints.</p></li>
<li><p>For <code class="docutils literal notranslate"><span class="pre">velocity</span></code> (<code class="docutils literal notranslate"><span class="pre">effort</span></code>) command interfaces, the position+velocity trajectory following error is mapped to <code class="docutils literal notranslate"><span class="pre">velocity</span></code> (<code class="docutils literal notranslate"><span class="pre">effort</span></code>) commands through a PID loop (<a class="reference internal" href="#parameters"><span class="std std-ref">Details about parameters</span></a>).</p></li>
</ul>
<p>This leads to the the following allowed combinations of command and state interfaces:</p>
<ul class="simple">
<li><p>With command interface <code class="docutils literal notranslate"><span class="pre">position</span></code>, there are no restrictions for state interfaces.</p></li>
<li><p>With command interface <code class="docutils literal notranslate"><span class="pre">velocity</span></code>:</p>
<ul>
<li><p>if command interface <code class="docutils literal notranslate"><span class="pre">velocity</span></code> is the only one, state interfaces must include  <code class="docutils literal notranslate"><span class="pre">position,</span> <span class="pre">velocity</span></code> .</p></li>
<li><p>no restrictions otherwise.</p></li>
</ul>
</li>
<li><p>With command interface <code class="docutils literal notranslate"><span class="pre">effort</span></code>, state interfaces must include  <code class="docutils literal notranslate"><span class="pre">position,</span> <span class="pre">velocity</span></code>.</p></li>
<li><p>With command interface <code class="docutils literal notranslate"><span class="pre">acceleration</span></code>, there are no restrictions for state interfaces.</p></li>
</ul>
<p>Example controller configurations can be found <a class="reference internal" href="#ros-2-interface"><span class="std std-ref">below</span></a>.</p>
<p>Similarly to the trajectory representation case above, it’s possible to support new hardware interfaces, or alternative mappings to an already supported interface (eg. a proxy controller for generating effort commands).</p>
</section>
<section id="other-features">
<h2>Other features<a class="headerlink" href="#other-features" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Realtime-safe implementation.</p></li>
<li><p>Proper handling of wrapping (continuous) joints.</p></li>
<li><p>Robust to system clock changes: Discontinuous system clock changes do not cause discontinuities in the execution of already queued trajectory segments.</p></li>
</ul>
</section>
<section id="using-joint-trajectory-controller-s">
<h2>Using Joint Trajectory Controller(s)<a class="headerlink" href="#using-joint-trajectory-controller-s" title="Permalink to this heading"></a></h2>
<p>The controller expects at least position feedback from the hardware.
Joint velocities and accelerations are optional.
Currently the controller does not internally integrate velocity from acceleration and position from velocity.
Therefore if the hardware provides only acceleration or velocity states they have to be integrated in the hardware-interface implementation of velocity and position to use these controllers.</p>
<p>The generic version of Joint Trajectory controller is implemented in this package.
A yaml file for using it could be:</p>
<blockquote>
<div><div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">controller_manager</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">joint_trajectory_controller</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;joint_trajectory_controller/JointTrajectoryController&quot;</span>

<span class="nt">joint_trajectory_controller</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ros__parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">joints</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint3</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint4</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint5</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">joint6</span>

<span class="w">    </span><span class="nt">command_interfaces</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">position</span>

<span class="w">    </span><span class="nt">state_interfaces</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">position</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">velocity</span>

<span class="w">    </span><span class="nt">action_monitor_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20.0</span>

<span class="w">    </span><span class="nt">allow_partial_joints_goal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">open_loop_control</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">constraints</span><span class="p">:</span>
<span class="w">      </span><span class="nt">stopped_velocity_tolerance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.01</span>
<span class="w">      </span><span class="nt">goal_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">      </span><span class="nt">joint1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">trajectory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.05</span>
<span class="w">        </span><span class="nt">goal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.03</span>
</pre></div>
</div>
</div></blockquote>
<section id="preemption-policy">
<h3>Preemption policy <a class="footnote-reference brackets" href="#f1" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="headerlink" href="#preemption-policy" title="Permalink to this heading"></a></h3>
<p>Only one action goal can be active at any moment, or none if the topic interface is used. Path and goal tolerances are checked only for the trajectory segments of the active goal.</p>
<p>When an active action goal is preempted by another command coming from the action interface, the goal is canceled and the client is notified.</p>
<p>Sending an empty trajectory message from the topic interface (not the action interface) will override the current action goal and not abort the action.</p>
</section>
<section id="details-about-parameters">
<span id="parameters"></span><h3>Details about parameters<a class="headerlink" href="#details-about-parameters" title="Permalink to this heading"></a></h3>
<dl>
<dt>joints (list(string))</dt><dd><p>Joint names to control and listen to.</p>
</dd>
<dt>command_joints (list(string))</dt><dd><p>Joint names to control. This parameters is used if JTC is used in a controller chain where command and state interfaces don’t have same names.</p>
</dd>
<dt>command_interface (list(string))</dt><dd><p>Command interfaces provided by the hardware interface for all joints.</p>
<p>Values: [position | velocity | acceleration] (multiple allowed)</p>
</dd>
<dt>state_interfaces (list(string))</dt><dd><p>State interfaces provided by the hardware for all joints.</p>
<p>Values: position (mandatory) [velocity, [acceleration]].
Acceleration interface can only be used in combination with position and velocity.</p>
</dd>
<dt>action_monitor_rate (double)</dt><dd><p>Rate to monitor status changes when the controller is executing action (control_msgs::action::FollowJointTrajectory).</p>
<p>Default: 20.0</p>
</dd>
<dt>allow_partial_joints_goal (boolean)</dt><dd><p>Allow joint goals defining trajectory for only some joints.</p>
<p>Default: false</p>
</dd>
<dt>allow_integration_in_goal_trajectories (boolean)</dt><dd><p>Allow integration in goal trajectories to accept goals without position or velocity specified</p>
<p>Default: false</p>
</dd>
<dt>interpolation_method (string)</dt><dd><p>The type of interpolation to use, if any. Can be “splines” or “none”.</p>
<p>Default: splines</p>
</dd>
<dt>open_loop_control (boolean)</dt><dd><p>Use controller in open-loop control mode:</p>
<ul class="simple">
<li><p>The controller ignores the states provided by hardware interface but using last commands as states for starting the trajectory interpolation.</p></li>
<li><p>It deactivates the feedback control, see the <code class="docutils literal notranslate"><span class="pre">gains</span></code> structure.</p></li>
</ul>
<p>This is useful if hardware states are not following commands, i.e., an offset between those (typical for hydraulic manipulators).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If this flag is set, the controller tries to read the values from the command interfaces on activation.
If they have real numeric values, those will be used instead of state interfaces.
Therefore it is important set command interfaces to NaN (i.e., <code class="docutils literal notranslate"><span class="pre">std::numeric_limits&lt;double&gt;::quiet_NaN()</span></code>) or state values when the hardware is started.</p>
</div>
<p>Default: false</p>
</dd>
<dt>constraints (structure)</dt><dd><p>Default values for tolerances if no explicit values are states in JointTrajectory message.</p>
</dd>
<dt>constraints.stopped_velocity_tolerance (double)</dt><dd><p>Default value for end velocity deviation.</p>
<p>Default: 0.01</p>
</dd>
<dt>constraints.goal_time (double)</dt><dd><p>Maximally allowed tolerance for not reaching the end of the trajectory in a predefined time.</p>
<p>Default: 0.0 (not checked)</p>
</dd>
<dt>constraints.&lt;joint_name&gt;.trajectory (double)</dt><dd><p>Maximally allowed deviation from the target trajectory for a given joint.</p>
<p>Default: 0.0 (tolerance is not enforced)</p>
</dd>
<dt>constraints.&lt;joint_name&gt;.goal (double)</dt><dd><p>Maximally allowed deviation from the goal (end of the trajectory) for a given joint.</p>
<p>Default: 0.0 (tolerance is not enforced)</p>
</dd>
<dt>gains (structure)</dt><dd><p>Only relevant, if <code class="docutils literal notranslate"><span class="pre">open_loop_control</span></code> is not set.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">velocity</span></code> is the only command interface for all joints or an <code class="docutils literal notranslate"><span class="pre">effort</span></code> command interface is configured, PID controllers are used for every joint.
This structure contains the controller gains for every joint with the control law</p>
<div class="math notranslate nohighlight">
\[u = k_{ff} v_d + k_p e + k_i \sum e dt + k_d (v_d - v)\]</div>
<p>with the desired velocity <span class="math notranslate nohighlight">\(v_d\)</span>, the measured velocity <span class="math notranslate nohighlight">\(v\)</span>, the position error <span class="math notranslate nohighlight">\(e\)</span> (definition see below),
the controller period <span class="math notranslate nohighlight">\(dt\)</span>, and the <code class="docutils literal notranslate"><span class="pre">velocity</span></code> or <code class="docutils literal notranslate"><span class="pre">effort</span></code> manipulated variable (control variable) <span class="math notranslate nohighlight">\(u\)</span>, respectively.</p>
</dd>
<dt>gains.&lt;joint_name&gt;.p (double)</dt><dd><p>Proportional gain <span class="math notranslate nohighlight">\(k_p\)</span> for PID</p>
<p>Default: 0.0</p>
</dd>
<dt>gains.&lt;joint_name&gt;.i (double)</dt><dd><p>Integral gain <span class="math notranslate nohighlight">\(k_i\)</span> for PID</p>
<p>Default: 0.0</p>
</dd>
<dt>gains.&lt;joint_name&gt;.d (double)</dt><dd><p>Derivative gain <span class="math notranslate nohighlight">\(k_d\)</span> for PID</p>
<p>Default: 0.0</p>
</dd>
<dt>gains.&lt;joint_name&gt;.i_clamp (double)</dt><dd><p>Integral clamp. Symmetrical in both positive and negative direction.</p>
<p>Default: 0.0</p>
</dd>
<dt>gains.&lt;joint_name&gt;.ff_velocity_scale (double)</dt><dd><p>Feed-forward scaling <span class="math notranslate nohighlight">\(k_{ff}\)</span> of velocity</p>
<p>Default: 0.0</p>
</dd>
<dt>gains.&lt;joint_name&gt;.normalize_error (bool)</dt><dd><p>If true, the position error <span class="math notranslate nohighlight">\(e = normalize(s_d - s)\)</span> is normalized between <span class="math notranslate nohighlight">\(-\pi, \pi\)</span>.
Otherwise  <span class="math notranslate nohighlight">\(e = s_d - s\)</span> is used, with the desired position <span class="math notranslate nohighlight">\(s_d\)</span> and the measured
position <span class="math notranslate nohighlight">\(s\)</span> from the state interface. Use this for revolute joints without end stop,
where the shortest rotation to the target position is the desired motion.</p>
<p>Default: false</p>
</dd>
</dl>
</section>
<section id="description-of-controller-s-interfaces">
<span id="ros-2-interface"></span><h3>Description of controller’s interfaces<a class="headerlink" href="#description-of-controller-s-interfaces" title="Permalink to this heading"></a></h3>
<section id="references">
<h4>References<a class="headerlink" href="#references" title="Permalink to this heading"></a></h4>
<p>(the controller is not yet implemented as chainable controller)</p>
</section>
<section id="states">
<h4>States<a class="headerlink" href="#states" title="Permalink to this heading"></a></h4>
<p>The state interfaces are defined with <code class="docutils literal notranslate"><span class="pre">joints</span></code> and <code class="docutils literal notranslate"><span class="pre">state_interfaces</span></code> parameters as follows: <code class="docutils literal notranslate"><span class="pre">&lt;joint&gt;/&lt;state_interface&gt;</span></code>.
Supported state interfaces are <code class="docutils literal notranslate"><span class="pre">position</span></code>, <code class="docutils literal notranslate"><span class="pre">velocity</span></code>, <code class="docutils literal notranslate"><span class="pre">acceleration</span></code> and <code class="docutils literal notranslate"><span class="pre">effort</span></code> as defined in the <a class="reference external" href="https://github.com/ros-controls/ros2_control/blob/master/hardware_interface/include/hardware_interface/types/hardware_interface_type_values.hpp">hardware_interface/hardware_interface_type_values.hpp</a>.</p>
<p>Legal combinations of state interfaces are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">position</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">position</span></code> and <code class="docutils literal notranslate"><span class="pre">velocity</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">position</span></code>, <code class="docutils literal notranslate"><span class="pre">velocity</span></code> and <code class="docutils literal notranslate"><span class="pre">acceleration</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">effort</span></code></p></li>
</ul>
</section>
<section id="commands">
<h4>Commands<a class="headerlink" href="#commands" title="Permalink to this heading"></a></h4>
<p>There are two mechanisms for sending trajectories to the controller:</p>
<ul class="simple">
<li><p>via action, see <a class="reference internal" href="#actions"><span class="std std-ref">actions</span></a></p></li>
<li><p>via topic, see <a class="reference internal" href="#subscriber"><span class="std std-ref">subscriber</span></a></p></li>
</ul>
<p>Both use the <code class="docutils literal notranslate"><span class="pre">trajectory_msgs/JointTrajectory</span></code> message to specify trajectories, and require specifying values for all the controller joints (as opposed to only a subset) if <code class="docutils literal notranslate"><span class="pre">allow_partial_joints_goal</span></code> is not set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</section>
<section id="actions">
<span id="id7"></span><h4>Actions  <a class="footnote-reference brackets" href="#f1" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="headerlink" href="#actions" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>&lt;controller_name&gt;/follow_joint_trajectory [control_msgs::action::FollowJointTrajectory]</dt><dd><p>Action server for commanding the controller</p>
</dd>
</dl>
<p>The primary way to send trajectories is through the action interface, and should be favored when execution monitoring is desired.
Action goals allow to specify not only the trajectory to execute, but also (optionally) path and goal tolerances.
When no tolerances are specified, the defaults given in the parameter interface are used (see <a class="reference internal" href="#parameters"><span class="std std-ref">Details about parameters</span></a>).
If tolerances are violated during trajectory execution, the action goal is aborted, the client is notified, and the current position is held.</p>
</section>
<section id="subscriber">
<span id="id9"></span><h4>Subscriber <a class="footnote-reference brackets" href="#f1" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="headerlink" href="#subscriber" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>&lt;controller_name&gt;/joint_trajectory [trajectory_msgs::msg::JointTrajectory]</dt><dd><p>Topic for commanding the controller</p>
</dd>
</dl>
<p>The topic interface is a fire-and-forget alternative. Use this interface if you don’t care about execution monitoring.
The controller’s path and goal tolerance specification is not used in this case, as there is no mechanism to notify the sender about tolerance violations.
Note that although some degree of monitoring is available through the <code class="docutils literal notranslate"><span class="pre">~/query_state</span></code> service and <code class="docutils literal notranslate"><span class="pre">~/state</span></code> topic it is much more cumbersome to realize than with the action interface.</p>
</section>
<section id="publishers">
<h4>Publishers<a class="headerlink" href="#publishers" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>&lt;controller_name&gt;/controller_state [control_msgs::msg::JointTrajectoryControllerState]</dt><dd><p>Topic publishing internal states with the update-rate of the controller manager</p>
</dd>
</dl>
</section>
<section id="services">
<h4>Services<a class="headerlink" href="#services" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>&lt;controller_name&gt;/query_state [control_msgs::srv::QueryTrajectoryState]</dt><dd><p>Query controller state at any future time</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="specialized-versions-of-jointtrajectorycontroller-tbd-in">
<h2>Specialized versions of JointTrajectoryController (TBD in …)<a class="headerlink" href="#specialized-versions-of-jointtrajectorycontroller-tbd-in" title="Permalink to this heading"></a></h2>
<p>The controller types are placed into namespaces according to their command types for the hardware (see <a class="reference external" href="../../index.rst">general introduction into controllers</a>).</p>
<p>The following version of the Joint Trajectory Controller are available mapping the following interfaces:</p>
<ul class="simple">
<li><p>position_controllers::JointTrajectoryController</p></li>
</ul>
<p class="rubric">Footnote</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="f1" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id3">2</a>,<a role="doc-backlink" href="#id4">3</a>,<a role="doc-backlink" href="#id5">4</a>,<a role="doc-backlink" href="#id6">5</a>,<a role="doc-backlink" href="#id8">6</a>)</span>
<p>Adolfo Rodriguez: <a class="reference external" href="http://wiki.ros.org/joint_trajectory_controller">joint_trajectory_controller</a></p>
</aside>
<aside class="footnote brackets" id="f2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Adolfo Rodriguez: <a class="reference external" href="http://wiki.ros.org/joint_trajectory_controller/UnderstandingTrajectoryReplacement">Understanding trajectory replacement</a></p>
</aside>
</aside>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../../position_controllers/doc/userdoc.html" class="btn btn-neutral float-right" title="position_controllers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../../gripper_controllers/doc/userdoc.html" class="btn btn-neutral float-left" title="Gripper Action Controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2023, ros2_control Maintainers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: master
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>ros2_control - Rolling</dt>
      <dd><a href="userdoc.html">Master (latest)</a></dd>
    </dl>
    <dl>
      <dt>ros2_control - Foxy and Galactic</dt>
        <dd><a href="../../../../../galactic/doc/ros2_controllers/joint_trajectory_controller/doc/userdoc.html">Galactic (recommended)</a></dd><br>
        <dd><a href="../../../../../foxy/doc/ros2_controllers/joint_trajectory_controller/doc/userdoc.html">Foxy</a></dd><br>
    </dl>
  </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>